<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global Leaderboard</title>
    <link rel="stylesheet" href="../style.css"> 
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ†</text></svg>">
</head>
<body style="background: #1a1a1a; color: white; text-align: center; font-family: sans-serif;">

    <h1>ğŸ† Global Top 10</h1>
    <table style="margin: 0 auto; width: 80%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #007bff;">
                <th>Rank</th>
                <th>Player</th>
                <th>Cookies</th>
            </tr>
        </thead>
        <tbody id="leaderboardBody">
            </tbody>
    </table>
    <br>
    <a href="/" style="color: #007bff;">â† Back to Game</a>

    <script>
        // Upstash Bilgileri (Oyun sayfasÄ±ndakiyle aynÄ± olmalÄ±)
        const REDIS_URL = "https://pleased-stinkbug-52622.upstash.io";
        const REDIS_TOKEN = "Ac2OAAIncDI0ZGVkODYxN2RkOGI0NmUyYTY0MGJlNGZlNjc0ZGUwN3AyNTI2MjI";

        async function loadLeaderboard() {
            try {
                // VeritabanÄ±ndan veriyi Ã§ek
                const response = await fetch(`${REDIS_URL}/get/leaderboard`, {
                    headers: { Authorization: `Bearer ${REDIS_TOKEN}` }
                });
                const result = await response.json();
                
                // Gelen veri metin formatÄ±ndaysa JSON'a Ã§evir, yoksa boÅŸ liste yap
                const data = result.result ? JSON.parse(result.result) : [];
                
                const tableBody = document.getElementById('leaderboardBody');
                
                if (data.length === 0) {
                    tableBody.innerHTML = "<tr><td colspan='3'>HenÃ¼z kimse kurabiye yapmamÄ±ÅŸ!</td></tr>";
                    return;
                }

                tableBody.innerHTML = data.map((player, index) => `
                    <tr style="border-bottom: 1px solid #333; height: 40px;">
                        <td>${index + 1}</td>
                        <td style="color: #007bff; font-weight: bold;">${player.name}</td>
                        <td>${player.score.toLocaleString()}</td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error("Tablo yÃ¼klenemedi:", err);
                document.getElementById('leaderboardBody').innerHTML = "<tr><td colspan='3'>VeritabanÄ± hatasÄ±!</td></tr>";
            }
        }

        // Sayfa aÃ§Ä±lÄ±nca yÃ¼kle
        loadLeaderboard();
    </script>
</body>
</html>
